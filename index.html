<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Family Tree</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            height: 100vh;
            touch-action: none;
        }

        #tree-container {
            width: 100%;
            height: 100vh;
            position: relative;
            cursor: grab;
            overflow: hidden;
            touch-action: none;
        }

        #tree-container.grabbing {
            cursor: grabbing;
        }

        #tree-canvas {
            position: absolute;
            transform-origin: 0 0;
            touch-action: none;
        }

        .person {
            position: absolute;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            transition: transform 0.2s;
            z-index: 10;
            touch-action: none;
        }

        .person:hover {
            transform: scale(1.1);
            z-index: 20;
        }

        .person:active {
            transform: scale(1.1);
            z-index: 20;
        }

        .person-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 4px solid white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            background-size: cover;
            background-position: center;
            background-color: #9333ea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            font-weight: bold;
        }

        .person-name {
            margin-top: 8px;
            color: white;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            text-align: center;
            max-width: 100px;
            font-size: 14px;
            background: rgba(102, 126, 234, 0.8);
            padding: 4px 10px;
            border-radius: 12px;
            white-space: nowrap;
            position: relative;
            z-index: 15;
        }

        #controls {
            position: fixed;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 10px;
            z-index: 100;
            flex-wrap: wrap;
            justify-content: flex-end;
            max-width: calc(100% - 20px);
        }

        button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            background: white;
            color: #667eea;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            transition: all 0.2s;
            font-size: 14px;
            touch-action: manipulation;
            min-height: 44px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        #person-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            z-index: 1000;
            max-width: 400px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        #modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 999;
        }

        .modal-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background-size: cover;
            background-position: center;
            border: 4px solid #667eea;
            background-color: #9333ea;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
        }

        .modal-info {
            margin: 10px 0;
        }

        .modal-info label {
            font-weight: 600;
            color: #667eea;
            display: block;
            margin-bottom: 4px;
        }

        .modal-info p {
            color: #333;
            word-wrap: break-word;
        }

        .close-btn {
            float: right;
            font-size: 28px;
            cursor: pointer;
            color: #999;
            line-height: 1;
            padding: 0 5px;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #zoom-controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 100;
        }

        .zoom-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 24px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Mobile-specific styles */
        @media (max-width: 768px) {
            #controls {
                top: 10px;
                right: 10px;
                gap: 8px;
                padding: 0;
            }

            button {
                padding: 10px 16px;
                font-size: 13px;
                min-height: 44px;
            }

            #zoom-controls {
                bottom: 20px;
                right: 20px;
                gap: 10px;
            }

            .zoom-btn {
                width: 50px;
                height: 50px;
                font-size: 22px;
                min-height: 50px;
            }

            #person-modal {
                padding: 20px;
                width: 92%;
                max-height: 85vh;
            }

            .person-circle {
                width: 70px;
                height: 70px;
                font-size: 20px;
                border-width: 3px;
            }

            .person-name {
                font-size: 12px;
                padding: 3px 8px;
                max-width: 85px;
            }

            .modal-photo {
                width: 100px;
                height: 100px;
                font-size: 40px;
            }

            .close-btn {
                font-size: 32px;
                min-width: 44px;
                min-height: 44px;
            }
        }

        /* Extra small screens */
        @media (max-width: 480px) {
            button {
                padding: 8px 12px;
                font-size: 12px;
                min-height: 44px;
            }

            #controls {
                gap: 6px;
                top: 8px;
                right: 8px;
            }

            .person-circle {
                width: 60px;
                height: 60px;
                font-size: 18px;
            }

            .person-name {
                font-size: 11px;
                padding: 2px 6px;
                max-width: 70px;
            }

            #zoom-controls {
                bottom: 15px;
                right: 15px;
            }

            .zoom-btn {
                width: 48px;
                height: 48px;
                font-size: 20px;
            }

            #person-modal {
                padding: 16px;
                width: 94%;
            }

            .modal-info {
                margin: 8px 0;
            }

            .modal-info label {
                font-size: 14px;
            }

            .modal-info p {
                font-size: 14px;
            }
        }

        /* Landscape mobile */
        @media (max-width: 768px) and (orientation: landscape) {
            #controls {
                top: 5px;
                right: 5px;
            }

            #zoom-controls {
                bottom: 10px;
                right: 10px;
            }

            #person-modal {
                max-height: 90vh;
                width: 80%;
            }
        }
    </style>
</head>
<body>
    <div id="tree-container">
        <div id="tree-canvas"></div>
    </div>

    <div id="controls">
        <button id="reset-view-btn">Reset View</button>
    </div>

    <div id="zoom-controls">
        <button class="zoom-btn" id="zoom-in">+</button>
        <button class="zoom-btn" id="zoom-out">âˆ’</button>
    </div>

    <div id="modal-overlay"></div>
    
    <div id="person-modal">
        <span class="close-btn" id="close-modal">&times;</span>
        <div class="modal-photo" id="modal-photo"></div>
        <h2 id="modal-name" style="text-align: center; color: #667eea; margin-bottom: 20px;"></h2>
        <div class="modal-info">
            <label>Email:</label>
            <p id="modal-email"></p>
        </div>
        <div class="modal-info">
            <label>Phone:</label>
            <p id="modal-phone"></p>
        </div>
        <div class="modal-info">
            <label>Birthday:</label>
            <p id="modal-birthday"></p>
        </div>
        <div class="modal-info">
            <label>Notes:</label>
            <p id="modal-notes"></p>
        </div>
    </div>

    <script src="family-data.js"></script>
    <script>
        const container = document.getElementById('tree-container');
        const canvas = document.getElementById('tree-canvas');
        
        let scale = 1;
        let translateX = 0;
        let translateY = 0;
        let isDragging = false;
        let startX = 0;
        let startY = 0;
        let lastTouchDistance = 0;
        let isMultiTouch = false;
        let touchStartTime = 0;
        let touchStartPos = { x: 0, y: 0 };
        
        const TAP_THRESHOLD = 300;
        const TAP_DISTANCE_THRESHOLD = 10;

        function drawTree() {
            canvas.innerHTML = '';
            
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.style.pointerEvents = 'none';
            canvas.appendChild(svg);

            familyData.forEach(person => {
                createPersonElement(person);
                
                if (person.parents && person.parents.length > 0) {
                    person.parents.forEach(parentId => {
                        const parent = familyData.find(p => p.id === parentId);
                        if (parent) {
                            drawConnection(svg, parent.x + 40, parent.y + 80, person.x + 40, person.y);
                        }
                    });
                }
                
                if (person.spouse) {
                    const spouse = familyData.find(p => p.id === person.spouse);
                    if (spouse) {
                        drawMarriageConnection(svg, person, spouse);
                    }
                }
            });
        }

        function drawConnection(svg, x1, y1, x2, y2) {
            const midY = (y1 + y2) / 2;
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', `M ${x1} ${y1} L ${x1} ${midY} L ${x2} ${midY} L ${x2} ${y2}`);
            path.setAttribute('stroke', 'white');
            path.setAttribute('stroke-width', '3');
            path.setAttribute('fill', 'none');
            path.setAttribute('opacity', '0.6');
            svg.appendChild(path);
        }

        function drawMarriageConnection(svg, person1, person2) {
            const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            line.setAttribute('x1', person1.x + 40);
            line.setAttribute('y1', person1.y + 40);
            line.setAttribute('x2', person2.x + 40);
            line.setAttribute('y2', person2.y + 40);
            line.setAttribute('stroke', 'white');
            line.setAttribute('stroke-width', '4');
            line.setAttribute('opacity', '0.8');
            svg.appendChild(line);
        }

        function createPersonElement(person) {
            const personDiv = document.createElement('div');
            personDiv.className = 'person';
            personDiv.style.left = person.x + 'px';
            personDiv.style.top = person.y + 'px';
            personDiv.dataset.personId = person.id;
            
            const circle = document.createElement('div');
            circle.className = 'person-circle';
            
            if (person.photo) {
                circle.style.backgroundImage = `url(${person.photo})`;
            } else {
                circle.textContent = person.name.charAt(0).toUpperCase();
            }
            
            const name = document.createElement('div');
            name.className = 'person-name';
            name.textContent = person.name;
            
            personDiv.appendChild(circle);
            personDiv.appendChild(name);
            
            personDiv.addEventListener('click', (e) => {
                e.stopPropagation();
                showPersonDetails(person);
            });
            
            canvas.appendChild(personDiv);
            
            if (person.marriedInto) {
                createMarriedCouple(person);
            }
        }

        function createMarriedCouple(bornIntoFamily) {
            const marriedIn = familyData.find(p => p.id === bornIntoFamily.marriedInto);
            if (!marriedIn) return;
            
            const spouseDiv = document.createElement('div');
            spouseDiv.className = 'person';
            spouseDiv.style.left = marriedIn.x + 'px';
            spouseDiv.style.top = marriedIn.y + 'px';
            spouseDiv.dataset.personId = marriedIn.id;
            
            const spouseCircle = document.createElement('div');
            spouseCircle.className = 'person-circle';
            
            if (marriedIn.photo) {
                spouseCircle.style.backgroundImage = `url(${marriedIn.photo})`;
            } else {
                spouseCircle.textContent = marriedIn.name.charAt(0).toUpperCase();
            }
            
            const spouseName = document.createElement('div');
            spouseName.className = 'person-name';
            spouseName.textContent = marriedIn.name;
            
            spouseDiv.appendChild(spouseCircle);
            spouseDiv.appendChild(spouseName);
            spouseDiv.addEventListener('click', (e) => {
                e.stopPropagation();
                showPersonDetails(marriedIn);
            });
            
            const familyDiv = document.createElement('div');
            familyDiv.className = 'person';
            familyDiv.style.left = bornIntoFamily.x + 'px';
            familyDiv.style.top = bornIntoFamily.y + 'px';
            familyDiv.dataset.personId = bornIntoFamily.id;
            
            const familyCircle = document.createElement('div');
            familyCircle.className = 'person-circle';
            
            if (bornIntoFamily.photo) {
                familyCircle.style.backgroundImage = `url(${bornIntoFamily.photo})`;
            } else {
                familyCircle.textContent = bornIntoFamily.name.charAt(0).toUpperCase();
            }
            
            const familyName = document.createElement('div');
            familyName.className = 'person-name';
            familyName.textContent = bornIntoFamily.name;
            
            familyDiv.appendChild(familyCircle);
            familyDiv.appendChild(familyName);
            familyDiv.addEventListener('click', (e) => {
                e.stopPropagation();
                showPersonDetails(bornIntoFamily);
            });
            
            canvas.appendChild(spouseDiv);
            canvas.appendChild(familyDiv);
        }

        function showPersonDetails(person) {
            document.getElementById('modal-photo').style.backgroundImage = 
                person.photo ? `url(${person.photo})` : 'none';
            document.getElementById('modal-photo').textContent = 
                person.photo ? '' : person.name.charAt(0).toUpperCase();
            document.getElementById('modal-name').textContent = person.name;
            document.getElementById('modal-email').textContent = person.email || 'N/A';
            document.getElementById('modal-phone').textContent = person.phone || 'N/A';
            document.getElementById('modal-birthday').textContent = person.birthday || 'N/A';
            document.getElementById('modal-notes').textContent = person.notes || 'N/A';
            
            document.getElementById('modal-overlay').style.display = 'block';
            document.getElementById('person-modal').style.display = 'block';
        }

        function updateTransform() {
            canvas.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
        }

        // Mouse event handlers
        container.addEventListener('mousedown', (e) => {
            if (e.target === container || e.target === canvas) {
                isDragging = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
                container.classList.add('grabbing');
            }
        });

        container.addEventListener('mousemove', (e) => {
            if (isDragging) {
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                updateTransform();
            }
        });

        container.addEventListener('mouseup', () => {
            isDragging = false;
            container.classList.remove('grabbing');
        });

        container.addEventListener('mouseleave', () => {
            isDragging = false;
            container.classList.remove('grabbing');
        });

        // Touch event handlers
        container.addEventListener('touchstart', (e) => {
            touchStartTime = Date.now();
            
            if (e.touches.length === 1) {
                const touch = e.touches[0];
                touchStartPos = { x: touch.clientX, y: touch.clientY };
                isDragging = true;
                startX = touch.clientX - translateX;
                startY = touch.clientY - translateY;
                isMultiTouch = false;
            } else if (e.touches.length === 2) {
                e.preventDefault();
                isDragging = false;
                isMultiTouch = true;
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                lastTouchDistance = Math.hypot(
                    touch2.clientX - touch1.clientX,
                    touch2.clientY - touch1.clientY
                );
            }
        }, { passive: false });

        container.addEventListener('touchmove', (e) => {
            if (e.touches.length === 1 && isDragging && !isMultiTouch) {
                const touch = e.touches[0];
                translateX = touch.clientX - startX;
                translateY = touch.clientY - startY;
                updateTransform();
            } else if (e.touches.length === 2) {
                e.preventDefault();
                const touch1 = e.touches[0];
                const touch2 = e.touches[1];
                const currentDistance = Math.hypot(
                    touch2.clientX - touch1.clientX,
                    touch2.clientY - touch1.clientY
                );
                
                if (lastTouchDistance > 0) {
                    const delta = currentDistance / lastTouchDistance;
                    scale *= delta;
                    scale = Math.max(0.3, Math.min(3, scale));
                    updateTransform();
                }
                
                lastTouchDistance = currentDistance;
            }
        }, { passive: false });

        container.addEventListener('touchend', (e) => {
            const touchDuration = Date.now() - touchStartTime;
            
            if (e.touches.length === 0) {
                if (touchDuration < TAP_THRESHOLD && isDragging) {
                    const touch = e.changedTouches[0];
                    const distance = Math.hypot(
                        touch.clientX - touchStartPos.x,
                        touch.clientY - touchStartPos.y
                    );
                    
                    if (distance < TAP_DISTANCE_THRESHOLD) {
                        const element = document.elementFromPoint(touch.clientX, touch.clientY);
                        if (element) {
                            const personDiv = element.closest('.person');
                            if (personDiv && personDiv.dataset.personId) {
                                const personId = parseInt(personDiv.dataset.personId);
                                const person = familyData.find(p => p.id === personId);
                                if (person) {
                                    showPersonDetails(person);
                                }
                            }
                        }
                    }
                }
                
                isDragging = false;
                isMultiTouch = false;
                lastTouchDistance = 0;
            } else if (e.touches.length === 1) {
                const touch = e.touches[0];
                startX = touch.clientX - translateX;
                startY = touch.clientY - translateY;
                lastTouchDistance = 0;
                isMultiTouch = false;
                isDragging = true;
            }
        });

        container.addEventListener('touchcancel', () => {
            isDragging = false;
            isMultiTouch = false;
            lastTouchDistance = 0;
        });

        // Mouse wheel zoom
        container.addEventListener('wheel', (e) => {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            scale *= delta;
            scale = Math.max(0.3, Math.min(3, scale));
            updateTransform();
        }, { passive: false });

        // Zoom button handlers
        document.getElementById('zoom-in').addEventListener('click', () => {
            scale *= 1.2;
            scale = Math.min(3, scale);
            updateTransform();
        });

        document.getElementById('zoom-out').addEventListener('click', () => {
            scale *= 0.8;
            scale = Math.max(0.3, scale);
            updateTransform();
        });

        document.getElementById('reset-view-btn').addEventListener('click', () => {
            scale = 1;
            translateX = container.offsetWidth / 2 - 200;
            translateY = 50;
            updateTransform();
        });

        // Modal close handlers
        document.getElementById('close-modal').addEventListener('click', () => {
            document.getElementById('modal-overlay').style.display = 'none';
            document.getElementById('person-modal').style.display = 'none';
        });

        document.getElementById('modal-overlay').addEventListener('click', () => {
            document.getElementById('modal-overlay').style.display = 'none';
            document.getElementById('person-modal').style.display = 'none';
        });

        // Initialize
        translateX = container.offsetWidth / 2 - 200;
        translateY = 50;
        updateTransform();
        drawTree();

        // Recalculate on window resize
        window.addEventListener('resize', () => {
            translateX = container.offsetWidth / 2 - 200;
            translateY = 50;
            updateTransform();
        });
    </script>
</body>
</html>
